
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.4">
    
    
      
        <title>Cloud Architecture - EE579 Group 4 Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cloud-architecture" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="EE579 Group 4 Docs" class="md-header__button md-logo" aria-label="EE579 Group 4 Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EE579 Group 4 Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cloud Architecture
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/fraserb99/ee579-docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="EE579 Group 4 Docs" class="md-nav__button md-logo" aria-label="EE579 Group 4 Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    EE579 Group 4 Docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/fraserb99/ee579-docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        For Developers
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="For Developers" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          For Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../register-device/" class="md-nav__link">
        Registering a Device
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../mqtt/" class="md-nav__link">
        Connecting to the broker
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../mqtt-schema/" class="md-nav__link">
        Messaging Schema
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../webhooks/" class="md-nav__link">
        Web Hooks
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        For Users
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="For Users" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          For Users
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../create-account/" class="md-nav__link">
        Creating an Account
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../multi-tenancy/" class="md-nav__link">
        Multi-Tenancy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../users/" class="md-nav__link">
        Managing Users
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../devices/" class="md-nav__link">
        Managing Devices
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../rules/" class="md-nav__link">
        Rules
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        For Maintainers
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="For Maintainers" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          For Maintainers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        API
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../front-end/" class="md-nav__link">
        Front End
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Cloud Architecture
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Cloud Architecture
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cloud-provider" class="md-nav__link">
    Cloud Provider
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    Architecture Overview
  </a>
  
    <nav class="md-nav" aria-label="Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database" class="md-nav__link">
    Database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-interface" class="md-nav__link">
    Web Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iot-hub-and-event-hubs" class="md-nav__link">
    IoT Hub and Event Hubs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docs-site" class="md-nav__link">
    Docs Site
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cloud-provider" class="md-nav__link">
    Cloud Provider
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-overview" class="md-nav__link">
    Architecture Overview
  </a>
  
    <nav class="md-nav" aria-label="Architecture Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    API
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database" class="md-nav__link">
    Database
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#web-interface" class="md-nav__link">
    Web Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iot-hub-and-event-hubs" class="md-nav__link">
    IoT Hub and Event Hubs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docs-site" class="md-nav__link">
    Docs Site
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/fraserb99/ee579-docs/edit/main/docs/cloud-architecture.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="cloud-architecture">Cloud Architecture<a class="headerlink" href="#cloud-architecture" title="Permanent link">#</a></h1>
<h2 id="cloud-provider">Cloud Provider<a class="headerlink" href="#cloud-provider" title="Permanent link">#</a></h2>
<p>The majority of the cloud components of this system are currently hosted on the Microsoft Azure platform. The cloud provider is not tightly coupled to the application for the most part, so you are free to use the provider of your choice. The only exception to this is for IoT Hub and consequently <a href="https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-devguide-messages-read-builtin">Event Hubs</a>, for which more information can be found <a href="#iot-hub">here</a>. It should also be noted that this docs site is hosted using <a href="https://pages.github.com/">GitHub Pages</a> - more detail about how this works can be found in the <a href="#docs-site">Docs Site Section</a>.</p>
<p>The Azure Portal is available at <a href="https://portal.azure.com">portal.azure.com</a> and can be used to create and manage cloud resources.</p>
<h2 id="architecture-overview">Architecture Overview<a class="headerlink" href="#architecture-overview" title="Permanent link">#</a></h2>
<p><img alt="" src="../img/cloud-arch.png" /></p>
<p>This diagram shows how the cloud services integrate with each other. This section will detail how each of these services is hosted to allow you to replicate the hosting setup on the provider of your choice.</p>
<h3 id="api">API<a class="headerlink" href="#api" title="Permanent link">#</a></h3>
<p>The API is hosted as an <a href="https://azure.microsoft.com/en-gb/services/app-service/">Azure App Service</a>. This is a Platform-as-a-Service (PaaS) offering from Azure that enables applications to be run without having to configure the underlying server as everything like the web server config is handled behind-the-scenes by Azure. Before an App Service can be created, an <a href="https://docs.microsoft.com/en-us/azure/app-service/overview-hosting-plans">App Service Plan</a> must be created. App Service Plans can contain multiple App Services, with the scale being configured at the App Service Plan level.</p>
<p>The following screenshot shows an example configuration for an App Service Plan.</p>
<p><img alt="" src="../img/app-service-config.png" /></p>
<p>The only options that must be set as shown in the screenshot are the <code>Publish: Code</code> and <code>Runtime Stack: .NET 5</code> options. All of the rest are up to you. Our API has cross-platform support and can run on Windows or Linux. We cannot provide any direct instructions as we have not done it, but the API can be hosted on other providers like AWS, or alternatively can be run on a local server running IIS, Kestrel, or another web server.</p>
<p>There are several environment variables that must be set for the API to function correctly. If you are hosting the app on an App Service, it is as simple as setting 2 values in the configuration section of the App Service:</p>
<p><img alt="" src="../img/app-settings.png" /></p>
<p>If you are hosting on another service then the environment variables should be set directly with the following names:</p>
<ul>
<li><strong><code>ASPNETCORE_ENVIRONMENT</code></strong> - This should be set to <code>Staging</code></li>
<li><strong><code>ConnectionStrings__Default</code></strong> - This should be the connection string for your database</li>
</ul>
<p>You may also need to edit some values in <code>appsettings.Staging.json</code>. The values from this file get loaded as configuration options.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    <span class="nt">&quot;AppSettings&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;AdminUrl&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.ee579-group4.net&quot;</span><span class="p">,</span>
        <span class="nt">&quot;ApiUrl&quot;</span><span class="p">:</span> <span class="s2">&quot;http://ee579-dev-api.azurewebsites.net&quot;</span><span class="p">,</span>
        <span class="nt">&quot;SmtpSettings&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;EmailEnabled&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nt">&quot;Host&quot;</span><span class="p">:</span> <span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Port&quot;</span><span class="p">:</span> <span class="mi">587</span><span class="p">,</span>
            <span class="nt">&quot;Email&quot;</span><span class="p">:</span> <span class="s2">&quot;ee579.ifttt@gmail.com&quot;</span><span class="p">,</span>
            <span class="nt">&quot;Password&quot;</span><span class="p">:</span> <span class="s2">&quot;**********&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>For example, if you are hosting the API on another URL, you should change the <code>"ApiUrl"</code> value to reflect this. You can also change the Smtp server used for sending email here.</p>
<h3 id="database">Database<a class="headerlink" href="#database" title="Permanent link">#</a></h3>
<p>We are using Azure SQL to host our database, a cloud database service using Microsoft's <a href="https://docs.microsoft.com/en-us/sql/sql-server/?view=sql-server-ver15">SQLServer</a>. You are in no means tied to this SQL variation, however. One of the benefits of using EF Core is that it abstracts the database itself from the code. This means that you are free to use any of the <a href="https://docs.microsoft.com/en-us/ef/core/providers/?tabs=dotnet-core-cli">supported database providers</a>.</p>
<p>To use a different database provider, you should first set the connection string as described in the previous section. You then must also change the following line in <a href="https://github.com/fraserb99/ee579-api/blob/develop/EE579/EE579.Api/Startup.cs"><code>Startup.cs</code></a> where the database connection is configured.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">private</span> <span class="k">void</span> <span class="nf">ConfigureEfCore</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">services</span><span class="p">.</span><span class="n">AddDbContext</span><span class="p">&lt;</span><span class="n">DatabaseContext</span><span class="p">&gt;(</span><span class="n">opts</span> <span class="p">=&gt;</span>
        <span class="n">opts</span><span class="p">.</span><span class="n">UseLazyLoadingProxies</span><span class="p">()</span>
<span class="hll">            <span class="p">.</span><span class="n">UseSqlServer</span><span class="p">(</span><span class="n">Configuration</span><span class="p">.</span><span class="n">GetConnectionString</span><span class="p">(</span><span class="s">&quot;Default&quot;</span><span class="p">)));</span>
</span><span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Change this to use the corresponding function, e.g., <code>UseSqlite</code> if you are using a Sqlite database.</p>
<h3 id="web-interface">Web Interface<a class="headerlink" href="#web-interface" title="Permanent link">#</a></h3>
<p>The web interface is hosted as an <a href="https://azure.microsoft.com/en-gb/services/app-service/static/">Azure Static Web App</a>. Azure Static Web Apps allow static sites to be hosted without using a web server. This is especially useful when the site is an SPA - <a href="../front-end/#single-page-applications">as described here</a>. SPAs don't require any processing to be performed on the server to serve the response, the server only needs to return the file containing the client-side code. Static Web Apps allow these files to be served through the use of a <abbr title="Content Delivery Network">CDN</abbr>, providing users with extremely fast page load times.</p>
<p>The site can also be hosted on a traditional server as well. Running <code>npm build</code> will generate a production-ready, minified build containing an <code>index.html</code> with references to the minified javascript files. This build can then be deployed to the wwwroot folder of any web server and served.</p>
<p>There is an additional piece of configuration required when configuring the web server running the site. Because the React app is an SPA, the web server only sees a single <code>index.html</code> file so assumes that the only root is the default <code>/</code>. This means that if someone navigates to <code>/sign-up</code> for example, the web server will not find a <code>sign-up.html</code> file, so will return a 404. To fix this we must route all requests to <code>/</code>. If hosting using a Static Web App, this can be done using a <code>routes.json</code> file in the <code>/public</code> folder.</p>
<div class="tabbed-set" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><label for="__tabbed_1_1">routes.json</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;routes&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;route&quot;</span><span class="p">:</span> <span class="s2">&quot;/*&quot;</span><span class="p">,</span>
            <span class="nt">&quot;serve&quot;</span><span class="p">:</span> <span class="s2">&quot;/index.html&quot;</span><span class="p">,</span>
            <span class="nt">&quot;statusCode&quot;</span><span class="p">:</span> <span class="mi">200</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
<p>The method for doing this may vary between web servers. to take IIS as an example, a <code>web.config</code> file can be used to configure the routing.</p>
<div class="tabbed-set" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><label for="__tabbed_2_1">web.config</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;system.webServer&gt;</span>    
        <span class="nt">&lt;rewrite&gt;</span>
            <span class="nt">&lt;rules&gt;</span>
                <span class="nt">&lt;remove</span> <span class="na">name=</span><span class="s">&quot;pushState&quot;</span> <span class="nt">/&gt;</span>
                <span class="nt">&lt;rule</span> <span class="na">name=</span><span class="s">&quot;pushState&quot;</span> <span class="na">stopProcessing=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;match</span> <span class="na">url=</span><span class="s">&quot;.*&quot;</span> <span class="nt">/&gt;</span>
                        <span class="nt">&lt;conditions</span> <span class="na">logicalGrouping=</span><span class="s">&quot;MatchAll&quot;</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;add</span> <span class="na">input=</span><span class="s">&quot;{REQUEST_FILENAME}&quot;</span> <span class="na">matchType=</span><span class="s">&quot;IsFile&quot;</span> <span class="na">negate=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
                        <span class="nt">&lt;add</span> <span class="na">input=</span><span class="s">&quot;{REQUEST_FILENAME}&quot;</span> <span class="na">matchType=</span><span class="s">&quot;IsDirectory&quot;</span> <span class="na">negate=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
                        <span class="nt">&lt;/conditions&gt;</span>
                        <span class="nt">&lt;action</span> <span class="na">type=</span><span class="s">&quot;Rewrite&quot;</span> <span class="na">url=</span><span class="s">&quot;/&quot;</span> <span class="nt">/&gt;</span>
                    <span class="nt">&lt;/rule&gt;</span>
            <span class="nt">&lt;/rules&gt;</span>
        <span class="nt">&lt;/rewrite&gt;</span>
    <span class="nt">&lt;/system.webServer&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div>
</div>
</div>
<h3 id="iot-hub-and-event-hubs">IoT Hub and Event Hubs<a class="headerlink" href="#iot-hub-and-event-hubs" title="Permanent link">#</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The IoT Hub setup is somewhat involved and requires more setup than the other components. If you are looking to replicate our cloud architecture we recommend that you continue to use our IoT Hub to simplify setup on both devices and the server.</p>
</div>
<p>IoT Hub implements a publish-subscribe pattern, used in this system to facilitate communication between the IoT devices and server.</p>
<p>IoT Hub is not a traditional MQTT broker, so to read messages sent from devices the server cannot just subscribe to their topics. Instead, IoT Hub exposes these messages through an  <a href="https://docs.microsoft.com/en-us/azure/iot-hub/iot-hub-devguide-messages-read-builtin">Event Hub built-in-endpoint</a>. The API then reads the messages from this Event Hub endpoint and processes them asynchronously.</p>
<p>A Blob Storage Account is also required to read messages from the built-in-endpoint. This is used to store checkpoint files which allow the API to keep its place in the message queue, like a bookmark. This prevents messages from being read twice. The storage account was omitted from the architecture diagram for brevity.</p>
<p>IoT Hub also allows you to expose device connection state events by routing them through an Event Hub. This means that when a device connects to the IoT Hub, a connection state message is routed to the corresponding Event Hub. Our application then reads the messages from this endpoint and updates the corresponding device's connection state in the database. This connection state is then displayed in the UI as shown <a href="../devices/#managing-existing-devices">here</a>.</p>
<p>If you do create your own IoT Hub, Event Hub, and storage account, simply change the connection strings in <a href="https://github.com/fraserb99/ee579-api/blob/develop/EE579/EE579.Core/Slices/IotHub/IotHubWorkerService.cs"><code>IotHubWorkerService.cs</code></a> and <a href="https://github.com/fraserb99/ee579-api/blob/develop/EE579/EE579.Domain/Messaging/IotMessagingService.cs"><code>IotMessagingService.cs</code></a> to point to your resources.</p>
<h3 id="docs-site">Docs Site<a class="headerlink" href="#docs-site" title="Permanent link">#</a></h3>
<p>The docs site is the site this documentation is currently available from - <a href="https://docs.ee579-group4.net">docs.ee579-group4.net</a>. This site is created using <a href="https://www.mkdocs.org/">MkDocs</a>, a static site generator that converts <a href="https://daringfireball.net/projects/markdown/">Markdown</a> files into a static site composed of html, css, and javascript.</p>
<p>Unlike the other components, this site is not hosted on Azure. Instead, GitHub pages is used. MkDocs provides easy integration with GitHub pages through their CLI. The following commands show how you can contribute to the documentation and deploy it.</p>
<ol>
<li>
<div class="highlight"><pre><span></span><code>pip install mkdocs &amp;&amp; pip install mkdocs-material
</code></pre></div>
</li>
<li>
<div class="highlight"><pre><span></span><code>git clone https://github.com/fraserb99/ee579-docs.git
</code></pre></div>
</li>
<li>
<div class="highlight"><pre><span></span><code>cd ee579-docs
</code></pre></div>
</li>
<li>
<div class="highlight"><pre><span></span><code>mkdocs serve
</code></pre></div>
</li>
<li>
<p>Make any changes you would like at this point</p>
</li>
<li>
<div class="highlight"><pre><span></span><code>mkdocs gh-deploy
</code></pre></div>
</li>
</ol>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../front-end/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Front End
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.4fa0e4ee.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.1d3bfcf1.min.js"></script>
      
    
  </body>
</html>