
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.4">
    
    
      
        <title>API - EE579 Group 4 Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="EE579 Group 4 Docs" class="md-header__button md-logo" aria-label="EE579 Group 4 Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EE579 Group 4 Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/fraserb99/ee579-docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="EE579 Group 4 Docs" class="md-nav__button md-logo" aria-label="EE579 Group 4 Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    EE579 Group 4 Docs
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/fraserb99/ee579-docs/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        For Developers
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="For Developers" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          For Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../register-device/" class="md-nav__link">
        Registering a Device
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../mqtt/" class="md-nav__link">
        Connecting to the broker
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../mqtt-schema/" class="md-nav__link">
        Messaging Schema
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../webhooks/" class="md-nav__link">
        Web Hooks
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        For Users
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="For Users" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          For Users
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../create-account/" class="md-nav__link">
        Creating an Account
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../multi-tenancy/" class="md-nav__link">
        Multi-Tenancy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../users/" class="md-nav__link">
        Managing Users
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../devices/" class="md-nav__link">
        Managing Devices
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../rules/" class="md-nav__link">
        Rules
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        For Maintainers
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="For Maintainers" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          For Maintainers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        API
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#framework-and-language" class="md-nav__link">
    Framework and Language
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-api" class="md-nav__link">
    Running the API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-the-apis-architecture-and-directory-structure" class="md-nav__link">
    Understanding the API's Architecture and Directory Structure
  </a>
  
    <nav class="md-nav" aria-label="Understanding the API's Architecture and Directory Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-module" class="md-nav__link">
    API Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-module" class="md-nav__link">
    Core Module
  </a>
  
    <nav class="md-nav" aria-label="Core Module">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#services" class="md-nav__link">
    Services
  </a>
  
    <nav class="md-nav" aria-label="Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dependency-injecting-services" class="md-nav__link">
    Dependency Injecting Services
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-module" class="md-nav__link">
    Domain Module
  </a>
  
    <nav class="md-nav" aria-label="Domain Module">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ef-core" class="md-nav__link">
    EF Core
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrations" class="md-nav__link">
    Migrations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../front-end/" class="md-nav__link">
        Front End
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cloud-architecture/" class="md-nav__link">
        Cloud Architecture
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#framework-and-language" class="md-nav__link">
    Framework and Language
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-api" class="md-nav__link">
    Running the API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-the-apis-architecture-and-directory-structure" class="md-nav__link">
    Understanding the API's Architecture and Directory Structure
  </a>
  
    <nav class="md-nav" aria-label="Understanding the API's Architecture and Directory Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-module" class="md-nav__link">
    API Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-module" class="md-nav__link">
    Core Module
  </a>
  
    <nav class="md-nav" aria-label="Core Module">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#services" class="md-nav__link">
    Services
  </a>
  
    <nav class="md-nav" aria-label="Services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dependency-injecting-services" class="md-nav__link">
    Dependency Injecting Services
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-module" class="md-nav__link">
    Domain Module
  </a>
  
    <nav class="md-nav" aria-label="Domain Module">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ef-core" class="md-nav__link">
    EF Core
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migrations" class="md-nav__link">
    Migrations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset"><a class="md-content__button md-icon" download href="..\pdf\combined.pdf" title="PDF Export"><svg style="height: 1.2rem; width: 1.2rem;" viewBox="0 0 384 512" xmlns="http://www.w3.org/2000/svg"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm76.45 211.36l-96.42 95.7c-6.65 6.61-17.39 6.61-24.04 0l-96.42-95.7C73.42 337.29 80.54 320 94.82 320H160v-80c0-8.84 7.16-16 16-16h32c8.84 0 16 7.16 16 16v80h65.18c14.28 0 21.4 17.29 11.27 27.36zM377 105L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128v-6.1c0-6.3-2.5-12.4-7-16.9z"></path></svg></a>
              
                
                  <a href="https://github.com/fraserb99/ee579-docs/edit/main/docs/api.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="api">API<a class="headerlink" href="#api" title="Permanent link">#</a></h1>
<h2 id="framework-and-language">Framework and Language<a class="headerlink" href="#framework-and-language" title="Permanent link">#</a></h2>
<p>The API was built using the framework ASP.NET Core, built on top of Microsoftâ€™s increasingly trending language, C#. ASP.NET Core is an web API specific framework that extends .NET Core. We are using .NET 5. </p>
<p>As we have followed industry level design and architectural patterns for ASP.NET Core web APIs, anyone with any ASP.NET Core experience should be able to pick up our API without knowing detailed knowledge of the component level logic. To learn more about ASP.NET Core, see <a href="https://docs.microsoft.com/en-us/aspnet/core/?view=aspnetcore-5.0">here</a>.</p>
<h2 id="running-the-api">Running the API<a class="headerlink" href="#running-the-api" title="Permanent link">#</a></h2>
<ol>
<li>First install Visual Studio from <a href="https://visualstudio.microsoft.com/downloads/">here</a></li>
<li>Pull our API with <code>git clone https://github.com/fraserb99/ee579-api.git</code></li>
<li>Navigate into the <code>EE579</code> directory</li>
<li>Open <code>EE579.sln</code> with Visual Studio. Visual Studio should automatically install all the necessary dependencies</li>
<li>Press the green play button on the top toolbar to run the API. This starts the API on localhost:5001</li>
</ol>
<h2 id="understanding-the-apis-architecture-and-directory-structure">Understanding the API's Architecture and Directory Structure<a class="headerlink" href="#understanding-the-apis-architecture-and-directory-structure" title="Permanent link">#</a></h2>
<p>The API is organised into three modules: Api, Core and Domain. The root directory structure for each module is shown below:</p>
<p><img alt="" src="../img/top-api-directories.PNG" /></p>
<ul>
<li>The <code>API</code> module contains functionality related to basic input/output in the API as well as launch configurations and application settings.</li>
<li>The <code>Core</code> module contains all the API logic for handling requests.</li>
<li>The <code>Domain</code> module contains all the mapped database entity objects. An object representation of the database is also stored at the root level in <code>DatabaseContext.cs.</code></li>
</ul>
<h3 id="api-module">API Module<a class="headerlink" href="#api-module" title="Permanent link">#</a></h3>
<p><img alt="" src="../img/apimod.PNG" /></p>
<p>Above, is the API Module with some of its main directories expanded. Within the <code>Controllers</code> directory, lies all the controllers for the API. A controller is a class that contains methods for the entry points for all our different endpoints. Controllers are split into their category. For example, all endpoints to do with users, such as getting a list of all users in the tennant, lie within the <code>UsersController</code> class. This get all endpoint within the UsersController can be seen below:</p>
<p><img alt="" src="../img/userscontr.PNG" /></p>
<p>We can see that there are various "attributes" above the method definition. Attributes can be used for various attribution related configuration to do with a particular method. In this case, there is the <code>[HttpGet]</code> attribute that defines this method as a GET request. You can find out more about attributes <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/controllers/filters?view=aspnetcore-5.0">here</a>. Within the methody body, a call to the method <code>GetAll()</code> is invoked upon the user service. This returns a list of user objects. More about services and dependency injection will be covered later. On the last line of this controller method, the list of users is returned to the front end. ASP.NET Core automatically serialises the list of user objects to JSON behind the scenes. </p>
<p>Moving back up one directory from the <code>Controllers</code> directory, is the <code>Infrastructure</code> directory. Within this directory contains definitions for custom attributes, exceptions, middleware that handles status codes, and as well as the swagger documentation configurations. In the route directory of the API module, lies two important classes: <code>Program</code> and <code>Startup</code>. <code>Program</code> launches the API and boostraps the <code>Startup</code> class. Within <code>Startup</code> contains many API configurations, service registering and authorization handling. Things such as CORS policies and bearer token authentication go in here. </p>
<h3 id="core-module">Core Module<a class="headerlink" href="#core-module" title="Permanent link">#</a></h3>
<p><img alt="" src="../img/core.PNG" /></p>
<p>Above, is the <code>Core</code> Module with some of its main directories expanded. At the highest directory level, is <code>Infrastructure</code>, <code>Models</code> and <code>Slices</code>. Similar to the <code>Infrastructure</code> directory in the <code>API</code> module, this directory contains classes that provide functionality to the system as a whole. Such as general utlity method overrides and extensions etc. </p>
<p><code>Models</code>, is a directory for data objects. The classes typically should only contain properties and not give any functionality around them. A <code>Models</code> directory, can be seen in multiple different places and levels within the API. This is for organisational purposes, for example, all models associated with users will be within a <code>Models</code> directory within the <code>Slices/Users</code> directory. </p>
<p>Within the <code>Slices</code> directory, contains the bulk of the API logic. In the context of the API, a slice, is a grouped section (or slice) of the API, where the grouping is organised by entity relation, such as users, rules, devices etc. That is, all logic handling with regards to that entity, is contained in its own slice.</p>
<p><img alt="" src="../img/devicegries.PNG" /></p>
<p>We can see above the <code>DeviceGroups</code> slice directory expanded. This shows a typical architecture for a slice. Within contains:</p>
<ul>
<li>A <code>Mapping</code> directory containing mapping profiles that define behaviour for mapping one object to another (with regards to this slice). </li>
<li>Another <code>Models</code> directory containg all data objects associated with this slice. </li>
<li>An <code>Impl</code> directory (short for implementation) that contains the service class for this slice that implements the respective service interface.</li>
<li>The respective service interface with regards to this slice. </li>
</ul>
<h4 id="services">Services<a class="headerlink" href="#services" title="Permanent link">#</a></h4>
<p>So what actually <em>is</em> a service? A service is a logic component used by the API. It is good practice to create a service for every slice in the API. In simple terms, the service will provide functionality and methods for interacting and manipulating the respective entity in that slice. So for example, the user service will have methods for getting a user from the database, creating a new user in the database, updating a user and so forth. The key thing that differentiates a service from a conventional class, is that services get registered in the aforementioned Startup class and can thereby be <strong>dependency injected</strong> into other classes such as controllers or even injected into other services.</p>
<h5 id="dependency-injecting-services">Dependency Injecting Services<a class="headerlink" href="#dependency-injecting-services" title="Permanent link">#</a></h5>
<p><strong>Dependency injection</strong> is when an object receives additional objects it depends on. For example, the <code>UsersController</code> needs access to the <code>UsersService</code> so that when a request to get a user is received, it can call this method on the user service which will return the user. For this to be possible, two steps are required:</p>
<ol>
<li><strong>Register the class as a service in Startup.cs</strong> - This is done like so within the <code>ConfigureServices</code> method in <code>Startup.cs</code>:
<img alt="" src="../img/dependy.PNG" />
This tells the API that the interface <code>IUserService</code> is parent to the <code>UserService</code> implementation. AddTransient means that upon every request to the API, ASP.NET Core will inject an instance of <code>UserService</code> with type <code>IUserService</code> into all objects that depend on it. AddTransient is so called named due to the transient lifecycle of the injected object. That is, after the request has finished execution, .NET will perform clean up and garbage collection to free up memory. It is injected with type <code>IUserService</code> rather than the <code>UserService</code> type itself because programming to the interface gives greater code decoupling and abstraction providing a well architectured and maintainable design. </li>
<li><strong>Receive the injection within an object</strong> - Receiving a dependency happens within the constructor of the class. This is shown below:</li>
</ol>
<p><img alt="" src="../img/userservy.PNG" /></p>
<p>You can see above, that the constructor for the <code>UsersController</code> takes an <code>IUserService</code> as one of its parameters. What gets passed in for this type, is then set as an instance variable. This is the user service dependency. But then where does the <code>IUserService</code> get passed in from? Because of the AddTransient method call made in <code>Startup.cs</code> in step 1, ASP.NET Core knows to look for all contructors that take the type <code>IUserService</code> as a parameter and will pass in an instance of UserService whenever a request to the API is made. This is seamless to the programmer, one of the benefits of such a design pattern. The dependency can then be interacted with using the instance variable, in this case the <code>_userService</code> reference.</p>
<h3 id="domain-module">Domain Module<a class="headerlink" href="#domain-module" title="Permanent link">#</a></h3>
<p><img alt="" src="../img/domain.PNG" /></p>
<p>Above is the directory structure of the domain module with the <code>Entities</code> directory expanded. The <code>Entities</code> directory contains object representations of database entities. These entity classes are mapped from the database and vice versa. This is achieved by the use of Entity Framework Core or EF Core for short.</p>
<h4 id="ef-core">EF Core<a class="headerlink" href="#ef-core" title="Permanent link">#</a></h4>
<p>Entity Framework Core is an object relational mapper. This means that it can map database tables to lists of objects where an object is an entry in the table. For example, a users table with 3 columns: id, username and password would get mapped to a list of <code>User</code> objects. Where a <code>User</code> object would have propeties of <code>id: int</code>, <code>username: string</code> and <code>password: string</code>. By interacting with these objects within the API in a conventional object orientated fashion, EF Core will update the database seamlessly behind the scenes. For example, to update the password of a user with <code>id</code> 1, you would search through the list of <code>User</code> objects until you find a <code>User</code> with its <code>id</code> property value equal to 1 and then updating the password on this selected object. EF Core will then update the database to reflect this change. For creating a <code>User</code> it is as simple as adding a new <code>User</code> object to the list of users.</p>
<h4 id="migrations">Migrations<a class="headerlink" href="#migrations" title="Permanent link">#</a></h4>
<p>But then how does the database schema stay in sync with the object representation in the API? Keeping the two domains in sync is inherently simple using the <a href="https://www.entityframeworktutorial.net/code-first/what-is-code-first.aspx">Code First</a> design approach with EF Core Migrations. Code First means that the database schema is reflective of the API domain entities rather than the API domain entities updating to match the database schema. For example, to add a new column/propert to the User domain object (and thus the database) the following steps are required:</p>
<ol>
<li>Open the <code>User</code> domain object in Entities/User.</li>
<li>Add a new field to the class. E.g <code>email: string</code>.</li>
<li>In the terminal in Visual Studio, run the command <code>Add-Migration AddedAnEmailColumn</code>.
..* This will generate some simple code that will add an <code>email</code> column to the database. It is worth quickly reviewing this to make sure it is what you want to do.</li>
<li>Run <code>Update-Database</code> this will execute the migration code and add the column to the database.</li>
</ol>
<p>When the API starts up, it will automatically check to make sure it has applied all the latest migrations. This ensures that the database always matches the object representation in the code.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../rules/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Rules
            </div>
          </div>
        </a>
      
      
        <a href="../front-end/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Front End
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.4fa0e4ee.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.1d3bfcf1.min.js"></script>
      
    
  </body>
</html>