<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Connecting to the broker - EE579 Group 4 Docs</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../css/theme.css" />
  <link rel="stylesheet" href="../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Connecting to the broker";
    var mkdocs_page_input_path = "mqtt.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> EE579 Group 4 Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">For Developers</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../register-device/">Registering a Device</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Connecting to the broker</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#connecting">Connecting</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#connecting-using-the-iothub-sdks">Connecting using the IotHub SDKs</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#using-our-example-code-for-an-esp8266">Using our Example Code for an ESP8266</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#connecting-directly-to-the-protocols">Connecting directly to the protocols</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../mqtt-schema/">Messaging Schema</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../webhooks/">Web Hooks</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">For Users</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../create-account/">Creating an Account</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../multi-tenancy/">Multi-Tenancy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../users/">Managing Users</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../devices/">Managing Devices</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../rules/">Rules</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">EE579 Group 4 Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>For Developers &raquo;</li>
        
      
    
    <li>Connecting to the broker</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="mqtt-broker">MQTT Broker<a class="headerlink" href="#mqtt-broker" title="Permanent link">#</a></h1>
<h2 id="connecting">Connecting<a class="headerlink" href="#connecting" title="Permanent link">#</a></h2>
<p>To connect to IoTHub there are multiple different protocols that can be used, you can either directly connect to these protocols or prefferably use one of the IoTHub device SDKs.</p>
<h3 id="connecting-using-the-iothub-sdks">Connecting using the IotHub SDKs<a class="headerlink" href="#connecting-using-the-iothub-sdks" title="Permanent link">#</a></h3>
<p>Connecting to IoTHub using one of Microsoft's SDKs use a connection string to connect. The connection string can be garnered from the response from our API's register request. Using the SDKs is the recommended way of connecting for its ease of use, especially regarding certificate handling as IoTHub forces TLS/SSL.</p>
<p>Some of the available SDKs include:</p>
<ul>
<li>
<p><a href="https://github.com/Azure/azure-iot-sdk-c">C SDK</a></p>
</li>
<li>
<p><a href="https://github.com/Azure/azure-iot-sdk-python">Python SDK</a></p>
</li>
<li>
<p><a href="https://github.com/Azure/azure-iot-sdk-node">Node.js SDK</a></p>
</li>
<li>
<p><a href="https://github.com/Azure/azure-iot-sdk-java">Java SDK</a></p>
</li>
<li>
<p><a href="https://github.com/Azure/azure-iot-sdk-csharp">.NET SDK</a></p>
</li>
</ul>
<h4 id="using-our-example-code-for-an-esp8266">Using our Example Code for an ESP8266<a class="headerlink" href="#using-our-example-code-for-an-esp8266" title="Permanent link">#</a></h4>
<p>We have provided some example code for registering a device with the API and sending/receiving messages from IoTHub. This example code is for the ESP8266 Wifi Module, but the methods will be similar on alternative devices. The code can be pulled from this <a href="https://github.com/fraserb99/ee579-msp430.git">repository</a>. Cd into the esp_iothub_client directory for the example code. By following the instructions <a href="https://github.com/Azure/azure-iot-arduino">here</a>, you can setup the Arduino IDE with functionality for flashing our example code to the ESP8266.</p>
<h3 id="connecting-directly-to-the-protocols">Connecting directly to the protocols<a class="headerlink" href="#connecting-directly-to-the-protocols" title="Permanent link">#</a></h3>
<p>As MQTT is usually implemented on memory restricted devices, it is possible that the memory required to implement broker connection/interaction using an SDK is unavailable. For this reason, directly connecting to the protocol might be required. Below is a mosquitto subscribe command showing the parameters required to manually connect to the cloud device topic.</p>
<pre><code>mosquitto_sub \
    -h IFTTT-Iot-Hub.azure-devices.net \
    -p 8883 \
    -t &quot;devices/00:0a:95:9d:68:16/messages/devicebound/#&quot; \
    -i 00:0a:95:9d:68:16 \
    -u &quot;IFTTT-Iot-Hub.azure-devices.net/00:0a:95:9d:68:16&quot; \
    -P &quot;SharedAccessSignature sr=IFTTT-Iot-Hub.azure-devices.net%2Fdevices%2F00%3A0a%3A95%3A9d%3A68%3A16&amp;sig=ulc08e%2FYp%2FMLJdyMLxsV7pqTQ12XamytzQjxFFithNg%3D&amp;se=1618623078&quot; \
    --cafile C:\Users\Fraser\GitHub\ee579-api\EE579\EE579.Core\Slices\Devices\Simulate\iotHubCert.pem -d -V mqttv311 -q 1
</code></pre>
<ul>
<li>
<p><strong>-h</strong>: The host name for the broker. </p>
</li>
<li>
<p><strong>-p</strong>: The port number of the broker.</p>
</li>
<li>
<p><strong>-t</strong>: The topic the cloud to device messages will be received on.</p>
</li>
<li>
<p><strong>-i</strong>: The unique identifier for the device. Recommended as the device MAC address.</p>
</li>
<li>
<p><strong>-u</strong>: The MQTT username which here is just set to the hostname/deviceId.</p>
</li>
<li>
<p><strong>-P</strong>: The password for the broker. Can be retrieved from the register API response.</p>
</li>
<li>
<p><strong>--catfile</strong>: Path to the IotHub Certificate.</p>
</li>
<li>
<p><strong>-V</strong>: The MQTT version. IotHub only supports MQTT version 3.1.1.</p>
</li>
<li>
<p><strong>-q</strong>: This is for the quality of service. IoTHub only supports a quality service of 1.</p>
</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../mqtt-schema/" class="btn btn-neutral float-right" title="Messaging Schema">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../register-device/" class="btn btn-neutral" title="Registering a Device"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../register-device/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../mqtt-schema/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
